<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gi·ªè H√†ng - Th·ªßy S·∫£n Th√°i S∆°n</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="cart.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8fafa; /* M√†u n·ªÅn ch√≠nh */
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            background-color: #0077b6;
            color: white;
            padding: 1em 2em;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            margin: 0;
            font-size: 1.8em;
        }

        .cart-container {
            flex-grow: 1; /* Cho ph√©p container gi·ªè h√†ng chi·∫øm h·∫øt kh√¥ng gian c√≤n l·∫°i */
            max-width: 1000px;
            margin: 40px auto;
            padding: 20px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }

        .cart-container h2 {
            text-align: center;
            color: #0077b6;
            margin-bottom: 30px;
            font-size: 2.2em;
        }

        .cart-table {
            width: 100%;
            border-collapse: separate; /* Cho ph√©p border-radius tr√™n cells */
            border-spacing: 0 10px; /* Kho·∫£ng c√°ch gi·ªØa c√°c h√†ng */
        }

        .cart-table th, .cart-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee; /* ƒê∆∞·ªùng k·∫ª ph√¢n c√°ch h√†ng */
        }

        .cart-table th {
            background-color: #e0f7fa; /* N·ªÅn cho ti√™u ƒë·ªÅ b·∫£ng */
            color: #0077b6;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.9em;
        }

        .cart-table tr:last-child td {
            border-bottom: none; /* Kh√¥ng c√≥ ƒë∆∞·ªùng k·∫ª d∆∞·ªõi c√πng */
        }

        .cart-item {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .cart-item img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .cart-item-info strong {
            display: block;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .quantity-controls button {
            background-color: #00b4d8;
            color: white;
            border: none;
            border-radius: 50%; /* N√∫t tr√≤n */
            width: 30px;
            height: 30px;
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .quantity-controls button:hover {
            background-color: #0077b6;
        }

        .quantity-controls span {
            display: inline-block;
            width: 30px;
            text-align: center;
            font-weight: bold;
        }

        .remove-item button {
            background-color: #ff4d4d; /* M√†u ƒë·ªè cho n√∫t x√≥a */
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-size: 0.9em;
        }

        .remove-item button:hover {
            background-color: #cc0000;
        }

        .cart-summary {
            margin-top: 30px;
            border-top: 2px solid #0077b6;
            padding-top: 20px;
            text-align: right;
            font-size: 1.2em;
            font-weight: bold;
        }

        .cart-summary div {
            margin-bottom: 10px;
        }

        .cart-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 15px;
        }

        .cart-actions button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .cart-actions .btn-continue {
            background-color: #00b4d8;
            color: white;
        }

        .cart-actions .btn-continue:hover {
            background-color: #0077b6;
            transform: translateY(-2px);
        }

        .cart-actions .btn-checkout {
            background-color: #28a745; /* M√†u xanh l√° cho n√∫t thanh to√°n */
            color: white;
        }

        .cart-actions .btn-checkout:hover {
            background-color: #218838;
            transform: translateY(-2px);
        }

        footer {
            background-color: #023e8a;
            color: white;
            text-align: center;
            padding: 30px 10px;
            margin-top: auto; /* ƒê·∫©y footer xu·ªëng d∆∞·ªõi c√πng */
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                padding: 1em;
            }
            .cart-container {
                margin: 20px 10px;
                padding: 15px;
            }
            .cart-table thead {
                display: none; /* ·∫®n ti√™u ƒë·ªÅ b·∫£ng tr√™n m√†n h√¨nh nh·ªè */
            }
            .cart-table, .cart-table tbody, .cart-table tr, .cart-table td {
                display: block; /* Chuy·ªÉn c√°c th√†nh ph·∫ßn b·∫£ng th√†nh kh·ªëi */
                width: 100%;
            }
            .cart-table tr {
                margin-bottom: 15px;
                border: 1px solid #ddd;
                border-radius: 8px;
                overflow: hidden;
            }
            .cart-table td {
                text-align: right;
                padding-left: 50%; /* T·∫°o kh√¥ng gian cho label gi·∫£ */
                position: relative;
                border-bottom: 1px solid #eee;
            }
            .cart-table td:before {
                content: attr(data-label); /* S·ª≠ d·ª•ng data-label l√†m ti√™u ƒë·ªÅ */
                position: absolute;
                left: 10px;
                width: calc(50% - 20px);
                padding-right: 10px;
                white-space: nowrap;
                font-weight: bold;
                color: #0077b6;
                text-align: left;
            }
            .cart-table tr:last-child td {
                 border-bottom: 1px solid #eee; /* Hi·ªÉn th·ªã l·∫°i ƒë∆∞·ªùng k·∫ª d∆∞·ªõi c√πng cho item cu·ªëi */
            }
            .cart-item {
                flex-direction: row; /* Gi·ªØ ·∫£nh v√† info tr√™n c√πng m·ªôt h√†ng */
                align-items: center;
                text-align: left;
            }
            .cart-item-info {
                flex-grow: 1; /* Cho ph√©p info chi·∫øm kh√¥ng gian */
            }
            .quantity-controls {
                justify-content: flex-end; /* CƒÉn ph·∫£i n√∫t s·ªë l∆∞·ª£ng */
            }
            .remove-item {
                text-align: right;
            }
            .cart-actions {
                flex-direction: column;
            }
            .cart-actions button {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Gi·ªè H√†ng C·ªßa B·∫°n</h1>
    </header>

    <div class="cart-container">
        <h2>Gi·ªè H√†ng</h2>

        <table class="cart-table">
            <thead>
                <tr>
                    <th>S·∫£n ph·∫©m</th>
                    <th>Gi√°</th>
                    <th>S·ªë l∆∞·ª£ng</th>
                    <th>T·ªïng ph·ª•</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="cart-items">
                <!-- Cart items will be loaded here by JavaScript -->
            </tbody>
        </table>

        <div class="cart-summary">
            <div>T·ªïng ti·ªÅn: <span id="cart-total">0ƒë</span></div>
        </div>

        <div class="cart-actions">
            <button class="btn-continue" onclick="window.location.href='webthuysanthaison.html'">Ti·∫øp t·ª•c mua s·∫Øm</button>
            <button class="btn-checkout">Thanh to√°n</button>
        </div>
    </div>

    <footer>
        <h3>Li√™n h·ªá v·ªõi ch√∫ng t√¥i</h3>
        <p>üìç S·ªë 123, ƒë∆∞·ªùng Bi·ªÉn C·∫£, Qu·∫≠n 7, TP.HCM</p>
        <p>üì± 0909 xxx xxx | üìß thaisson@thuysan.vn</p>
        <p>üåê www.thaissonthuysan.vn</p>
    </footer>

    <script>
        const dummyCartItems = [
        ];

        let cartItems = JSON.parse(localStorage.getItem('shoppingCart')) || dummyCartItems;
        const cartItemsContainer = document.getElementById('cart-items');
        const cartTotalSpan = document.getElementById('cart-total');

        /**
         * Renders all items currently in the cart.
         */
        function renderCart() {
            cartItemsContainer.innerHTML = ''; // Clear current items
            let total = 0;

            if (cartItems.length === 0) {
                cartItemsContainer.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 30px;">Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng.</td></tr>';
            } else {
                cartItems.forEach(item => {
                    const subtotal = item.price * item.quantity;
                    total += subtotal;

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td data-label="S·∫£n ph·∫©m">
                            <div class="cart-item">
                                <img src="${item.img}" alt="${item.name}" onerror="this.onerror=null;this.src='https://placehold.co/80x80/cccccc/333333?text=Image+Not+Found';">
                                <div class="cart-item-info">
                                    <strong>${item.name}</strong>
                                    <span>${formatCurrency(item.price)}/kg</span>
                                </div>
                            </div>
                        </td>
                        <td data-label="Gi√°">${formatCurrency(item.price)}</td>
                        <td data-label="S·ªë l∆∞·ª£ng">
                            <div class="quantity-controls">
                                <button data-id="${item.id}" data-action="decrease">-</button>
                                <span>${item.quantity}</span>
                                <button data-id="${item.id}" data-action="increase">+</button>
                            </div>
                        </td>
                        <td data-label="T·ªïng ph·ª•">${formatCurrency(subtotal)}</td>
                        <td class="remove-item">
                            <button data-id="${item.id}" data-action="remove">X√≥a</button>
                        </td>
                    `;
                    cartItemsContainer.appendChild(row);
                });
            }
            cartTotalSpan.textContent = formatCurrency(total);
            updateLocalStorage(); // Update local storage after rendering
        }

        /**
         * Handles quantity changes and item removal.
         * @param {Event} event - The click event.
         */
        function handleCartAction(event) {
            const button = event.target.closest('button');
            if (!button) return;

            const itemId = button.dataset.id; // Kh√¥ng d√πng parseInt
            const action = button.dataset.action;

            const itemIndex = cartItems.findIndex(item => item.id == itemId);

            if (itemIndex > -1) {
                if (action === 'increase') {
                    cartItems[itemIndex].quantity++;
                } else if (action === 'decrease') {
                    if (cartItems[itemIndex].quantity > 1) {
                        cartItems[itemIndex].quantity--;
                    } else {
                        // N·∫øu s·ªë l∆∞·ª£ng l√† 1 v√† gi·∫£m, x√≥a lu√¥n s·∫£n ph·∫©m
                        cartItems.splice(itemIndex, 1);
                    }
                } else if (action === 'remove') {
                    cartItems.splice(itemIndex, 1); // X√≥a s·∫£n ph·∫©m kh·ªèi gi·ªè
                }
                renderCart();
            }
        }
        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND',
                minimumFractionDigits: 0
            }).format(amount);
        }

        /**
         * Updates the shopping cart data in localStorage.
         */
        function updateLocalStorage() {
            localStorage.setItem('shoppingCart', JSON.stringify(cartItems));
        }
        cartItemsContainer.addEventListener('click', handleCartAction);
        window.onload = renderCart;

        // X·ª≠ l√Ω n√∫t "Thanh to√°n"
        document.querySelector('.btn-checkout').addEventListener('click', function() {
            // Gi·∫£ s·ª≠ user_id l√† 'U001' (b·∫°n c√≥ th·ªÉ l·∫•y t·ª´ ƒëƒÉng nh·∫≠p th·ª±c t·∫ø)
            const user_id = localStorage.getItem('user_id') || 'U001';
            if (cartItems.length === 0) {
                alert('Gi·ªè h√†ng tr·ªëng!');
                return;
            }
            fetch('place-order.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    user_id: user_id,
                    cart: cartItems
                })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert('ƒê·∫∑t h√†ng th√†nh c√¥ng!');
                    cartItems = [];
                    updateLocalStorage();
                    renderCart();
                } else {
                    alert('ƒê·∫∑t h√†ng th·∫•t b·∫°i: ' + data.message);
                }
            })
            .catch(() => {
                alert('Kh√¥ng th·ªÉ k·∫øt n·ªëi server!');
            });
        });
    </script>
</body>
</html>